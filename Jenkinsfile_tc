// ***********DON'T CHANGE ANY PARAMETER OR DETAILS IN SCRIPT FILE >This May lead to failure testing and deploy.**************
pipeline {
    agent any

	        // Environment Variables
            
	        environment {
	        // Remove brackets below({}) update project details inside double quotes
	        ProjectCloneUrl = "{}"
	        GitLab_SDMND = "{}"
	        GitLabProjectId = "{}"
	        ReleaseFolder = "{}"
	        ReleaseEnvironment = "Production"
	        ReleaseTenant = "Prod"
	        
            //By Default Configuration :
	        ithubBuildLoc = "C:\\Temp\\ReleaseBuildPackage"
	        ithub_TestResultLoc = "C:\\Temp\\testResults.xml"
	        ithub_VerifyResultLoc = "C:\\Temp\\CodeReviewRunResult\\TCRResult.txt"
	        ithub_ORCH_URL = "${env.OrchURL}"

	        // ***********DON'T CHANGE ANY PARAMETER OR SCRIPT SYNTAX WITHOUT ANY GUIDENCE >This May lead to failure on testing and deploy.************** 
	        
	    }

	    options {
	        //timestamps()
			timeout(time:60, unit:'MINUTES')
	        skipDefaultCheckout true
	    }

    stages {
        stage('A_Testing') {
            steps {
                //checkout scm
                script {
                    skipRemainingStages = false
                    try {
                        echo '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  Deploying to Prod Tenant <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<'
                        //echo 'Notify'
                        updateGitlabCommitStatus name: 'UiDeploy' , state: 'pending'
                        //echo 'cleaning project file workspace folder before deploy'
                        updateGitlabCommitStatus name: 'UiDeploy' , state: 'running'
                        ithubDeploy (environments: env.ReleaseEnvironment ,folderName: env.ReleaseFolder,orchestratorAddress: env.ithub_ORCH_URL ,orchestratorTenant: env.ReleaseTenant ,packagePath: env.ithubBuildLoc,credentials: UserPass('771ba50e-36d6-4ec8-8fff-5926cca941b4'))
                        echo 'success'
                        updateGitlabCommitStatus name: 'UiDeploy' , state: 'success'
                    }
                    
                    catch (Exception exc2) {
                        
                        skipRemainingStages = true
                        echo 'xxxxxxxx Failed Deploy xxxxxxxxx'
                        updateGitlabCommitStatus name: 'UiDeploy' , state: 'failed'
                    }

                    if (skipRemainingStages) {
                        
                        currentBuild.result = 'Failure in Deploy'
                        echo '-------- Failed Deploy ----------'
                        error("Stopping early")  
                    }
                }
            }
        }
}
}	
